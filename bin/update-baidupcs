#!/bin/sh

# Build BaiduPCS for macOS
# https://github.com/GangZhuo/BaiduPCS

clean()
{
    git reset --hard
    git clean -dfx
}

cd /data/projects/github/BaiduPCS

clean

oldRev=$(git rev-parse HEAD)
git pull origin master
newRev=$(git rev-parse HEAD)

if [ "$1" != "-f" ] && [ "$1" != "--force" ]; then
    if [[ $oldRev == $newRev ]]; then
        exit
    fi
fi

export LDFLAGS=-L/usr/local/opt/openssl/lib
export CPPFLAGS=-I/usr/local/opt/openssl/include
autoreconf
./configure --prefix=$(pwd)/build
make
make install
cp build/bin/baidupcs /data/tools/bin

clean

baidupcs
