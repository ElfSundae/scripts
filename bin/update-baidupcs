#!/bin/sh

# Build BaiduPCS for macOS
# https://github.com/GangZhuo/BaiduPCS

cd /data/projects/github/BaiduPCS

git reset --hard
git clean -dfx
REV=$(git log -1 --format="%h")
git pull
REV_NEW=$(git log -1 --format="%h")

if [ "$1" != "-f" ] && [ "$1" != "--force" ]; then
    if [[ $REV == $REV_NEW ]]; then
        exit
    fi
fi

export LDFLAGS=-L/usr/local/opt/openssl/lib
export CPPFLAGS=-I/usr/local/opt/openssl/include
autoreconf
./configure
make
make install

baidupcs
